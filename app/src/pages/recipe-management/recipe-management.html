<ion-header>
    <ion-backdrop style="opacity:0.35;" class="show-backdrop" (click)="toggleMode(false)" *ngIf="inputMode"></ion-backdrop>

    <ion-navbar>
        <ion-title (click)="editMode?showInput(recipe.name,'name',2):false">{{recipe.name || ('NEW_RECIPE' | translate)}}</ion-title>
        <ion-buttons end *ngIf="editMode">

            <button ion-button icon-only (click)="presentPopover($event)">
                        <ion-icon name="more"></ion-icon>
                      </button>

        </ion-buttons>
    </ion-navbar>
    <ion-card class="no-padding">
        <div class="fill" [@resizeImg]='imgState' (@resizeImg.done)="content.resize()" (touchstart)="swipe($event, 'start')" (touchend)="swipe($event, 'end')" [style.background-image]="getBackground(recipe.imageUrl)">
        </div>
    </ion-card>
    <ion-fab bottom left edge>
        <button ion-fab mini (click)="save()"><ion-icon [name]="editMode?'checkmark':'create'"></ion-icon></button>
    </ion-fab>
</ion-header>
<ion-backdrop style="opacity:0.35;" class="show-backdrop" (click)="toggleMode(false)" *ngIf="inputMode"></ion-backdrop>
<ion-content>
    <ion-grid *ngIf="!inputMode">
        <ion-row>
            <ion-col col-5>

            </ion-col>

            <ion-col col-4 (click)="editMode?showInput(recipe.duration,'duration',2):false">
                <ion-icon name='time'></ion-icon>
                <span class="label">{{recipe.duration==null?'--':(recipe.duration|time)}}</span>
            </ion-col>
            <ion-col col-3 (click)="editMode?showInput(recipe.servings,'servings',2):false">
                <span class="label">{{recipe.servings==null?'--':recipe.servings}}</span>
                <ion-icon name='people'></ion-icon>
            </ion-col>
        </ion-row>

        <ion-row>
            <ion-col col-12>
                <div [ngSwitch]="recipeContent">
                    <ion-list *ngSwitchCase="'ingredients'">
                        <ion-item-group>
                            <ion-item-sliding *ngFor="let ingredient of recipe.ingredients">
                                <ion-item>
                                    <ion-grid>
                                        <ion-row>
                                            <ion-col col-4 class="weight-info">
                                                {{(ingredient.quantity!=null? ingredient.quantity + ' ':'') + (ingredient.unit!=null? ingredient.unit + ' ':'')}}
                                            </ion-col>
                                            <ion-col col-8>
                                                {{ingredient.name}}
                                            </ion-col>
                                        </ion-row>
                                    </ion-grid>
                                </ion-item>
                                <ion-item-options side="left">
                                    <button *ngIf="editMode" ion-button color="secondary" (click)="showInput(ingredient,'ingredients',2)">
                                            <ion-icon name="create"></ion-icon>
                                            
                                          </button>
                                </ion-item-options>
                                <ion-item-options side="right">
                                    <button *ngIf="editMode" ion-button color="danger" (click)="delete(ingredient,'ingredients')">
                                            <ion-icon name="trash"></ion-icon>
                                            
                                          </button>
                                </ion-item-options>
                            </ion-item-sliding>
                        </ion-item-group>
                    </ion-list>
                    <ion-list *ngSwitchCase="'instructions'">
                        <ion-item-group>
                            <ion-item-sliding *ngFor="let instruction of recipe.instructions">
                                <ion-item>
                                    <ion-badge style="margin-right:5px">{{instruction.orderNb|| '-'}}</ion-badge>
                                    <span style="white-space: pre-line">{{instruction.description}}</span>
                                </ion-item>
                                <ion-item-options *ngIf="editMode" side="left">
                                    <button ion-button color="secondary" (click)="showInput(instruction,'instructions',2)">
                                                <ion-icon name="create"></ion-icon>
                                                
                                              </button>
                                </ion-item-options>
                                <ion-item-options *ngIf="editMode" side="right">
                                    <button ion-button color="danger" (click)="delete(instruction,'instructions')">
                                                <ion-icon name="trash"></ion-icon>
                                                
                                              </button>
                                </ion-item-options>
                            </ion-item-sliding>
                        </ion-item-group>
                    </ion-list>
                </div>
            </ion-col>
        </ion-row>
    </ion-grid>
    <ion-fab right bottom *ngIf="recipeContent=='instructions' && editMode && !inputMode && imgState!='expand'">
        <button mini ion-fab (click)="showInput([],'instructions',1)"><ion-icon name="add"></ion-icon></button>
    </ion-fab>
    <ion-fab right bottom *ngIf="recipeContent=='ingredients' && editMode && !inputMode && imgState!='expand'">
        <button mini ion-fab (click)="showInput([],'ingredients',1)"><ion-icon name="add"></ion-icon></button>
    </ion-fab>
</ion-content>
<ion-footer>
    <div padding *ngIf="!inputMode && imgState!='expand'">
        <ion-segment [(ngModel)]="recipeContent">
            <ion-segment-button value="ingredients">
                {{'INGREDIENTS' | translate}}
            </ion-segment-button>
            <ion-segment-button value="instructions">
                {{'INSTRUCIONS' | translate}}
            </ion-segment-button>
        </ion-segment>
    </div>
    <form [formGroup]="recipeForm" *ngIf="editMode && inputMode" (ngSubmit)="apply(inputRef, recipeForm.value)">
        <ion-toolbar *ngIf="editMode && inputMode">
            <ion-input *ngIf="inputRef=='name'" formControlName="name" class="text-white" autofocus></ion-input>
            <ion-input *ngIf="inputRef=='duration'" type="number" formControlName="duration" class="text-white" autofocus></ion-input>
            <ion-input *ngIf="inputRef=='servings'" type="number" formControlName="servings" class="text-white" autofocus></ion-input>
            <ion-grid *ngIf="inputRef=='ingredients'">
                <ion-row>
                    <ion-col col-2>
                        <ion-input type="number" placeholder="__" formControlName="quantity" class="text-white" autofocus></ion-input>
                    </ion-col>
                    <ion-col col-2>
                        <ion-input placeholder="__" formControlName="unit" class="text-white"></ion-input>
                    </ion-col>
                    <ion-col col-8>
                        <ion-input required placeholder="_______" formControlName="name" class="text-white"></ion-input>
                    </ion-col>
                </ion-row>
            </ion-grid>
            <ion-grid *ngIf="inputRef=='instructions'">
                <ion-row>
                    <ion-col col-12>
                        <ion-textarea required formControlName="description" class="text-white" autofocus></ion-textarea>
                    </ion-col>
                </ion-row>
            </ion-grid>
            <ion-buttons end>
                <button type="submit" [disabled]="!recipeForm.valid" ion-button>
                    <ion-icon name="checkmark"></ion-icon>
                  </button>
            </ion-buttons>
        </ion-toolbar>
    </form>

</ion-footer>